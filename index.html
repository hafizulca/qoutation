<script>
    // --- JAVASCRIPT LOGIC ---

    function clearDetails() {
        const outputArea = document.getElementById('plan-details-output');
        outputArea.innerHTML = '<p class="placeholder-text">Sila buat pilihan anda dari menu di atas untuk melihat butiran penuh pelan dan harga.</p>';
        outputArea.classList.remove('active', 'popular');
    }

    function showClassSelector(selectedPlan) {
        const classArea = document.getElementById('class-selection-area');
        const classSelector = document.getElementById('class-selector');

        clearDetails();

        if (selectedPlan) {
            classArea.style.display = 'block';
            classSelector.value = '';
        } else {
            classArea.style.display = 'none';
        }
    }

    function displayPlanDetails() {
        const selectedPlan = document.getElementById('plan-selector').value;
        const selectedClass = document.getElementById('class-selector').value;
        const outputArea = document.getElementById('plan-details-output');
        
        clearDetails();

        if (!selectedPlan || !selectedClass) {
            return;
        }

        const dataKey = `${selectedPlan}-${selectedClass}`;
        const planDataContainer = document.querySelector(`div[data-plan-class="${dataKey}"]`);

        if (planDataContainer) {
            const planNameOption = document.querySelector(`#plan-selector option[value="${selectedPlan}"]`).textContent;
            const price = planDataContainer.getAttribute('data-price');
            const isPopular = planDataContainer.getAttribute('data-popular') === 'true';

            const fullPlanName = `${planNameOption} - Kelas ${selectedClass}`;

            let content = `
                <div class="plan-card ${isPopular ? 'popular' : ''}">
                    <h2>${fullPlanName}</h2>
                    <div class="price">${price}</div>
                    ${planDataContainer.innerHTML}
                    <button class="select-btn ${isPopular ? 'popular-btn' : ''}">Pilih Pelan Ini</button>
                </div>
            `;

            outputArea.innerHTML = content;
            outputArea.classList.add('active');
            if (isPopular) {
                outputArea.classList.add('popular');
            } else {
                outputArea.classList.remove('popular');
            }
        } else {
            outputArea.innerHTML = `<p class="placeholder-text">Butiran Pelan ${dataKey} belum tersedia. Sila pilih kombinasi lain atau hubungi ejen.</p>`;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const contactForm = document.getElementById('quickContactForm');
        
        const myWhatsAppNumber = '601125517767';

        contactForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const name = document.getElementById('fullName').value;
            const dob = document.getElementById('birthDate').value;
            const occupation = document.getElementById('occupation').value;

            // Ambil nilai Pelan & Kelas
            const selectedPlan = document.getElementById('plan-selector').value;
            const selectedClass = document.getElementById('class-selector').value;

            let planDetails = "";

            if (selectedPlan) {
                const planNameOption = document.querySelector(`#plan-selector option[value="${selectedPlan}"]`).textContent;
                planDetails = `Pilihan Pelan: ${planNameOption}`;
                if (selectedClass) {
                    planDetails += ` (Kelas ${selectedClass})`;
                }
            } else {
                planDetails = "Tiada pilihan pelan dibuat.";
            }

            // --- Mesej WhatsApp CLEAN TANPA %0A BERTABUR ---
            const message =
                "Salam.\n\n" +
                `Saya *${name}* berminat dengan pelan Takaful.\n\n` +
                "*Maklumat Saya:*\n" +
                `Tarikh Lahir: ${dob}\n` +
                `Pekerjaan: ${occupation}\n` +
                `${planDetails}\n\n` +
                "Harap dapat hubungi saya segera. Terima kasih.";

            const encodedMessage = encodeURIComponent(message);

            const whatsappURL = `https://wa.me/${myWhatsAppNumber}?text=${encodedMessage}`;
            window.open(whatsappURL, '_blank');

            contactForm.reset();
        });
    });
</script>
